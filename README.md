# EXPRESS MVC SAMPLE

This Node.js project is a web application that utilizes the Express.js framework and a MySQL database to create a user-centric platform. To provide a meaningful example of the MVC pattern, the project employs various middleware for data processing, such as handling form submissions, cookies, logging, and parameter passing.

No external dependencies are used to create an *MVC Framework*. Instead, this sample uses the mechanisms already present in Express to model MVC architecture.

This project utilizes middlewares to symbolically position modules as **controllers**. **Models** are injected into controllers. **Views** are rendered using EJS. 

Using a 1 liner middleware know as *the bag*, state values flows downstream through each controller **action** used to process the HTTP requests.

## KEY FEATURES

- **Environment Configuration**: The project uses the `dotenv` library to manage environment variables, enhancing application portability and security. See env.example for usage details

- **Database Connectivity**: It connects to a MySQL database using the `mysql2` library and parses the database URL for connection details.

- **Express.js Server**: An Express HTTP server is initialized to serve web content and APIs.

- **Middleware**: The project incorporates middleware for handling form data, cookies, plus custom data storage for passing information between controllers (the *bag*).

- **User Management**: User-related functionality includes user login with password validation and the ability to view user profiles.

- **Logging**: The application logs requests and timestamps for debugging and monitoring.

This project can serve as a foundation for building web applications that require user authentication, data storage, and dynamic content rendering using the Express.js framework. It demonstrates the separation of concerns with controllers, views, and database connections.

## SETUP

- Clone the repository to a machine with node.js v16+ available.
- From the project folder, install the dependencies
`npm install`
- Copy `env.example`` to `.env` And replace the database connection string to connect with a MySQL database.
- Add a `users` table to your database. Include some a few sample users.
```
CREATE TABLE users (
    user_id CHAR(36),
    email VARCHAR(255) UNIQUE,
    password_md5 CHAR(32)
);

INSERT INTO users (user_id, email, password_md5)
VALUES
    (CONVERT(UUID(), CHAR(36)), 'user1@example.com', MD5('password1')),
    (CONVERT(UUID(), CHAR(36)), 'user2@example.com', MD5('password2')),
    (CONVERT(UUID(), CHAR(36)), 'user3@example.com', MD5('password3')),
    ...
```

## Route: `/`

- **Description**: This route represents the root URL of your web application.
- **Method**: GET
- **Controller**: `viewsController.index`
- **Purpose**: This route is responsible for rendering the application's main page, commonly known as the home page. Users visiting the root URL will be served content generated by the `index` method of the `viewsController`.

## Route: `/user/profile`

- **Description**: This route is used to access a user's profile page.
- **Method**: GET
- **Controller**: `userController.bagcookie`, `viewsController.profile`
- **Purpose**: When a user accesses this URL, the `bagcookie` middleware may execute first, adding the user's ID to the request's "bag." Afterward, the `profile` method from the `viewsController` generates and serves the user's profile page. This route requires authentication.

## Route: `/user/login`

- **Description**: This route is used for user login and authentication.
- **Method**: POST
- **Controller**: `userController.checkpassword`, `userController.bakecookie`
- **Purpose**: This route handles user login attempts. It first checks the user's password using the `checkpassword` method in the `userController`. If the password is correct, the `bakecookie` method is called create a JWT containing the user ID and store it in a cookie. After successful login, the user is redirected to their profile page (e.g., `/user/profile`).
